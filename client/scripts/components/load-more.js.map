{"version":3,"file":"load-more.js","sources":["src/throttle.js","src/threshold.js","../utils/perfect.js","../utils/dom-class.js","src/load-more.js"],"sourcesContent":["// https://remysharp.com/2010/07/21/throttling-function-calls\nexport default function throttle (fn, threshhold = 250) {\n  let last,\n    deferTimer;\n  \n  return function (...args) {\n    const now = Date.now();\n    \n    if (last && now < last + threshhold) {\n      // hold on to it\n      clearTimeout(deferTimer);\n      deferTimer = setTimeout(() => {\n        last = now;\n        fn(args);\n      }, threshhold);\n    } else {\n      last = now;\n      fn(args);\n    }\n  };\n}\n","export const ThresholdUnits = {\n  Pixel: 'Pixel',\n  Percent: 'Percent'\n};\n\nconst defaultThreshold = {\n  unit: ThresholdUnits.Percent,\n  value: 0.8\n};\n\nexport function parseThreshold (scrollThreshold) {\n  if (typeof scrollThreshold === 'number') {\n    return {\n      unit: ThresholdUnits.Percent,\n      value: scrollThreshold * 100\n    };\n  }\n\n  if (typeof scrollThreshold === 'string') {\n    if (scrollThreshold.match(/^(\\d*(\\.\\d+)?)px$/)) {\n      return {\n        unit: ThresholdUnits.Pixel,\n        value: parseFloat(scrollThreshold)\n      };\n    }\n\n    if (scrollThreshold.match(/^(\\d*(\\.\\d+)?)%$/)) {\n      return {\n        unit: ThresholdUnits.Percent,\n        value: parseFloat(scrollThreshold)\n      };\n    }\n\n    console.warn('scrollThreshold format is invalid. Valid formats: \"120px\", \"50%\"...');\n\n    return defaultThreshold;\n  }\n\n  console.warn('scrollThreshold should be string or number');\n\n  return defaultThreshold;\n}\n","export const doc = document;\nexport const win = window;\n","import { doc } from '../utils/perfect';\n\nexport function getElement (selector) {\n  let element;\n  if (typeof selector === 'string') {\n    element = doc.querySelector(selector);\n  } else if (selector && selector instanceof Element) {\n    element = selector;\n  }\n  \n  return element;\n}\n\n// 添加 class\nexport function addClass (selector, className) {\n  if (!selector || !className) {\n    return;\n  }\n  \n  const element = getElement(selector);\n  \n  if (element) {\n    if (Array.isArray(className)) {\n      className.forEach((item) => {\n        element.classList.add(item);\n      });\n    } else if (typeof className === 'string') {\n      element.classList.add(className);\n    }\n  }\n}\n\n// 删除 class\nexport function removeClass (selector, className) {\n  if (!selector || !className) {\n    return;\n  }\n  \n  const element = getElement(selector);\n  \n  if (element) {\n    if (Array.isArray(className)) {\n      className.forEach((item) => {\n        element.classList.remove(item);\n      });\n    } else if (typeof className === 'string') {\n      element.classList.remove(className);\n    }\n  }\n}\n\n// 包含 class\nexport function containsClass (selector, className) {\n  if (!selector || !className || typeof className !== 'string') {\n    return false;\n  }\n  \n  const element = getElement(selector);\n  \n  if (element) {\n    return element.classList.contains(className);\n  }\n  \n  return false;\n}\n","import throttle from './throttle';\nimport { parseThreshold, ThresholdUnits } from './threshold';\nimport { doc, win } from '../../utils/perfect';\nimport { getElement } from '../../utils/dom-class';\n\n// 参考 https://github.com/ankeetmaini/react-infinite-scroll-component\nclass LoadMore {\n  constructor ({\n    scrollThreshold = '200px', hasMore = true, loader = () => {\n    }, pageContainer, listContainer, loadPageData = () => {},\n    pageNum = 1, pageSize = 10, loadMoreMax = 50\n  }) {\n    const _pageContainer = getElement(pageContainer);\n    if (!_pageContainer) {\n      return;\n    }\n  \n    const _listContainer = getElement(listContainer);\n    if (!_listContainer) {\n      return;\n    }\n    // 是否在加载中\n    this.loading = false;\n  \n    // 是否已初始化\n    this.inited = false;\n    \n    // 是否有更多数据\n    this._hasMore = hasMore;\n    // 滑动到底部什么部分开始加载更多\n    this.scrollThreshold = scrollThreshold;\n    // 显示 loader 效果\n    this.loader = loader;\n    // 分页页码容器\n    this.pageContainer = _pageContainer;\n    // 列表容器\n    this.listContainer = _listContainer;\n    // 加载数据函数\n    this.loadPageData = loadPageData;\n  \n    // 当前页，从1开始，默认1\n    this.pageNum = pageNum;\n  \n    // 每页条数，默认10\n    this.pageSize = pageSize;\n    \n    // 加载更多最大值\n    this.loadMoreMax = loadMoreMax;\n    \n    // 滑动事件\n    this.onScrollListener = this.onScrollListener.bind(this);\n    // 防止抖动\n    this.throttledOnScrollListener = throttle(this.onScrollListener, 150).bind(\n      this\n    );\n    this.handleSwitchPage = this.handleSwitchPage.bind(this);\n    \n    this.init();\n  }\n  \n  set hasMore (more) {\n    this._hasMore = more;\n  }\n  \n  get hasMore () {\n    return this._hasMore;\n  }\n  \n  init () {\n    this.loadData();\n    this.initEvent();\n  }\n  \n  initEvent () {\n    win.addEventListener('scroll', this.throttledOnScrollListener);\n    this.pageContainer.addEventListener('click', this.handleSwitchPage);\n  }\n  \n  // 滑轮滚动事件\n  onScrollListener (event) {\n    // 防止多次重复加载更多\n    if (this.loading) {\n      return;\n    }\n  \n    // 如果没有初始化完成，则不滑动\n    if (!this.inited) {\n      return;\n    }\n    \n    const { deltaX } = event;\n    const detail = deltaX;\n    const direction = detail < -1;\n    // 向上滑动不处理\n    if (direction) {\n      return;\n    }\n    \n    const target = doc.documentElement.scrollTop\n      ? doc.documentElement\n      : doc.body;\n    \n    // 是否到底部\n    const atBottom = this.isElementAtBottom(target);\n    \n    // 调用 loadData 方法加载更多\n    if (atBottom && this.hasMore) {\n      this.loading = true;\n      this.loadData(this.pageNum + 1);\n    }\n  }\n  \n  // 加载数据\n  loadData (_pageNum = 1) {\n    if (this.loadPageData && typeof this.loadPageData === 'function') {\n      if (typeof this.loader === 'function') {\n        this.loader(true);\n      }\n      \n      this.loadPageData(_pageNum, this.pageSize, !this.hasMore).then(json => {\n        this.loading = false;\n        setTimeout(() => {\n          this.inited = true;\n        }, 300);\n        \n        const { totalCount, totalPages } = json.data;\n        this.totalPages = totalPages;\n        this.pageNum = _pageNum;\n        this.totalCount = totalCount;\n        this.renderPaging();\n  \n        // 只处理一次，如果是最后一页数据，或者是超过最大可滑动展示的数据，则 this.hashMore 设为 true\n        if (this.hasMore && (this.pageNum >= totalPages || this.pageNum * this.pageSize > this.loadMoreMax)) {\n          this.hasMore = false;\n          if (this.pageNum * this.pageSize > this.loadMoreMax) {\n            this.pageContainer.classList.add('show');\n          }\n        }\n  \n        if (typeof this.loader === 'function') {\n          this.loader(false);\n        }\n      }).catch(() => {\n        this.loading = false;\n        setTimeout(() => {\n          this.inited = true;\n        }, 300);\n        if (typeof this.loader === 'function') {\n          this.loader(false);\n        }\n      });\n    }\n  }\n  \n  // 切换页码\n  handleSwitchPage (evt) {\n    evt.preventDefault();\n    // 防止多次重复加载\n    if (this.loading) {\n      return;\n    }\n    \n    const { target } = evt;\n\n    const { classList } = target;\n\n    if (classList.contains('paging-item')) {\n      // 切换下一页逻辑\n      let pageNum = parseInt(target.dataset.pagenum, 10);\n      if (this.totalPages === 1) {\n        return;\n      }\n      if (pageNum <= 1) {\n        pageNum = 1;\n      }\n\n      if (pageNum >= this.totalPages) {\n        pageNum = this.totalPages;\n      }\n\n      this.loadData(pageNum);\n    }\n  };\n  \n  /**\n   * 计算页码显示算法，返回一个页码数组\n   * @returns {[]}\n   */\n  calculatePage () {\n    const pageArray = [];\n    if (this.totalPages < 8) {\n      for (let i = 1; i <= this.totalPages; i++) {\n        pageArray.push(i);\n      }\n    } else {\n      pageArray.push(1);\n      if (this.pageNum > 4) {\n        pageArray.push('...');\n      }\n      \n      if (this.pageNum < 4) {\n        for (let i = 2; i <= 6; i++) {\n          pageArray.push(i);\n        }\n      } else if (this.pageNum >= 4 && this.totalPages - this.pageNum >= 3) {\n        for (let i = this.pageNum - 2; i <= this.pageNum + 2; i++) {\n          pageArray.push(i);\n        }\n      } else {\n        for (let i = this.totalPages - 4; i < this.totalPages; i++) {\n          pageArray.push(i);\n        }\n      }\n      \n      // 总页码 - 当前页 大于 3 显示\n      if (this.totalPages - this.pageNum > 3) {\n        pageArray.push('...');\n      }\n      pageArray.push(this.totalPages);\n    }\n    \n    return pageArray;\n  }\n  \n  // 渲染分页\n  renderPaging () {\n    const pageArray = this.calculatePage();\n    \n    let html = '<ul class=\"paging-items\">';\n    html += `<li class=\"paging-item prev${\n      this.pageNum === 1 ? ' disabled' : ''\n    }\" data-pagenum=\"${this.pageNum - 1}\"></li>`;\n    const pageItems = pageArray.map((item, index) => {\n      if (item === '...') {\n        return '<li class=\"paging-item more\"></li>';\n      }\n      return `<li class=\"paging-item${\n        this.pageNum === item ? ' active' : ''\n      }\" data-pagenum=\"${item}\">${item}</li>`;\n    });\n    html += pageItems.join('');\n    html += `<li class=\"paging-item next${\n      this.pageNum === this.totalPages ? ' disabled' : ''\n    }\" data-pagenum=\"${this.pageNum + 1}\"></li>`;\n    html += '</ul>';\n  \n    this.pageContainer.innerHTML = html;\n  }\n  \n  // 是否滑动到底部\n  isElementAtBottom (target) {\n    const clientHeight =\n      target === doc.body || target === doc.documentElement\n        ? win.screen.availHeight\n        : target.clientHeight;\n    \n    const threshold = parseThreshold(this.scrollThreshold);\n    \n    if (threshold.unit === ThresholdUnits.Pixel) {\n      return (\n        target.scrollTop + clientHeight >= target.scrollHeight - threshold.value\n      );\n    }\n    \n    return (\n      target.scrollTop + clientHeight >= threshold.value / 100 * target.scrollHeight\n    );\n  }\n}\n\nexport default LoadMore;\n"],"names":["throttle","fn","threshhold","last","deferTimer","args","now","Date","clearTimeout","setTimeout","ThresholdUnits","Pixel","Percent","defaultThreshold","unit","value","parseThreshold","scrollThreshold","match","parseFloat","console","warn","doc","document","win","window","getElement","selector","element","querySelector","Element","LoadMore","hasMore","loader","pageContainer","listContainer","loadPageData","pageNum","pageSize","loadMoreMax","_pageContainer","_listContainer","loading","inited","_hasMore","onScrollListener","bind","throttledOnScrollListener","handleSwitchPage","init","loadData","initEvent","addEventListener","event","deltaX","detail","direction","target","documentElement","scrollTop","body","atBottom","isElementAtBottom","_pageNum","then","json","data","totalCount","totalPages","renderPaging","classList","add","catch","evt","preventDefault","contains","parseInt","dataset","pagenum","pageArray","i","push","calculatePage","html","pageItems","map","item","index","join","innerHTML","clientHeight","screen","availHeight","threshold","scrollHeight","more"],"mappings":"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"}